
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<!-- import conditional template -->
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">


<dom-module id="ref-element">
    <template>
      <style>
        :host {
          display: block;
          padding-left:0.15em;
        }
  
        .cite {        
          display: flex;
          position: absolute;
          margin-bottom:0px; 
        }	    
  
        .norm{
          --iron-icon-width:	24px;
          --iron-icon-height:	24px;
        }           
        </style>
        <li id="ref[[_num]]" > <a href="#cite[[_num]]" class="cite" >^</a> <template is="dom-if" if="[[_isBook(reftype)]]">   
            <!-- book -->       
              <iron-icon class="norm" icon="icons:language"></iron-icon>
              [[_authors(first,last,first2,last2,first3,last3)]]
              ([[year]]). <i> [[title]]</i>  [[publicationplace]]:  [[publisher]] p. [[page]] <i>"[[quote]]"</i>
            </template>
            
            <template is="dom-if" if="[[_isJournal(reftype)]]">
            <!-- journal -->
              <iron-icon  class="norm" icon="icons:book"></iron-icon>
              [[_authors(first,last,first2,last2,first3,last3)]]
              ([[year]]). " [[title]]".  [[journal]] 
              <template is="dom-if" if="[[_hasValue(volume)]]"><b>[[volume]]</b></template>
              <template is="dom-if" if="[[_hasValue(issue)]]">([[issue]]):</template>
              <template is="dom-if" if="[[_hasValue(pages)]]">[[pages]]</template>
              <template is="dom-if" if="[[_hasValue(doi)]]"> doi: [[doi]]</template>
            </template>      
  
            <template is="dom-if" if="[[_isWeb(reftype)]]">
              <!-- web -->
              <iron-icon  class="norm" icon="icons:bookmark"></iron-icon>           
              [[_authors(first,last,first2,last2,first3,last3)]]
              <a href src=[[url]]>[[title]]</a>. <i>[[website]]</i>. [[sourcedate]]. [[at]]. 
              <template is="dom-if" if="[[_hasValue(archiveurl)]]">
                <a href src=[[archiveurl]]>Archived</a> from the original on [[archivedate]]
              </template>
              <template is="dom-if" if="[[_hasValue(accessdate)]]"> Retrieved [[accessdate]]</template>
            </template> 
      </li>
      </template>
    
    <script>     
         
      /**
       * `reference2-element`
       * citation like in wikipedia
       *
       * @customElement
       * @polymer
       * @demo demo/index.html
       */
      class RefElement extends Polymer.Element {
  
        constructor(){
          super();
        //  console.log("Reference2Element created!");
        
        }
  
        ready(){
          super.ready();
        //  console.log("Reference2Element ready!");
          //this.textContent = 'I\'m a custom element';
        
        }
  
        connectedCallback() {
          super.connectedCallback();
        //  console.log("Reference2Element connected!");
          // â€¦
        }
  
        static get is() { return 'ref-element'; }
  
        static get properties() {
          return {
            _num: {              type: Number },
            accessdate:{         type: String },          
            archivedate:{        type: String },
            archiveurl:{         type: String },
            at:{                 type: String },
            database:{           type: String },
            doi:{                type: String },            
            first :{             type: String },
            first2:{             type: String },            
            first3:{             type: String },  // Year of authorship or publication
            isbn  :{             type: String },         
            issn  :{             type: String },         
            issue :{             type: String },         
            journal:{            type: String },         
            last  :{             type: String },  // The author's first or given name. 
            last2 :{             type: String },  // The author's first or given name. 
            last3 :{             type: String },  // The author's first or given name.                       
            page:{               type: String },            
            pages:{              type: String },            
            publisher:{          type: String },
            sourcedate:{         type: String },
            publicationplace:{   type: String },            
            quote:{              type: String },
            title :{             type: String },  // The name of the publisher
            reftype: {           type: String },
            url:{                type: String },
            urlaccess : {         type:String },
            volume  :{           type: String }, 
            website  :{          type: String }, 
            year  :{             type: String }        
  
          }
        } 
  
        _isBook(refType){
        //  console.log(`_isBook ? ${refType}` );
          return refType==='book';
        }
  
        _isWeb(refType){
        //  console.log(`_isWeb ? ${refType}` );
          return refType==='web';
        }
  
        _isJournal(refType){
        //  console.log(`_isJournal ? ${refType}` );
          return refType==='journal';
        }
  
        _hasValue(test){
          return test.length>0;
  
        }
  
        _authors(first="",last="",first2="",last2="",first3="",last3=""){
          const a1=`${last}, ${first} `;
          const a2=`; ${last2}, ${first2} `;
          const a3=`; ${last3}, ${first3}`;  
          var res =  a1.length<3 ? "" : a1;
          res += a2.length<6 ? "" : a2;
          res += a3.length<5 ? "" : a3;
          return res;
      }
  
      _accessIcon(){ return "Lock-green.svg"  }
  
    }
     
      window.customElements.define(RefElement.is, RefElement);
    </script>
  </dom-module>
  